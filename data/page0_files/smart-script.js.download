function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=Array(r);t<r;t++)a[t]=e[t];return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,n,o,i,s=[],l=!0,c=!1;try{if(o=(t=t.call(e)).next,0!==r)for(;!(l=(a=o.call(t)).done)&&(s.push(a.value),s.length!==r);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(c)throw n}}return s}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ownKeys(e,r){var t,a=Object.keys(e);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(e),r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)),a}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _toPrimitive(e,r){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);if("object"!=typeof(t=t.call(e,r||"default")))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){return"symbol"==typeof(e=_toPrimitive(e,"string"))?e:e+""}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}var AF_URL_SCHEME="(https:\\/\\/)(([^\\.]+).)(.*\\/)(.*)",VALID_AF_URL_PARTS_LENGTH=5,GOOGLE_CLICK_ID="gclid",FACEBOOK_CLICK_ID="fbclid",GBRAID="gbraid",WBRAID="wbraid",ASSOCIATED_AD_KEYWORD="keyword",AF_KEYWORDS="af_keywords",AF_CUSTOM_EXCLUDE_PARAMS_KEYS=["pid","c","af_channel","af_ad","af_adset","deep_link_value","af_sub1","af_sub2","af_sub3","af_sub4","af_sub5"],GCLID_EXCLUDE_PARAMS_KEYS=["pid","c","af_channel","af_ad","af_adset","deep_link_value"],LOCAL_STORAGE_VALUES={SS_WEB_REFERRER:"ss_webReferrer"},isSkippedURL=function(e){var r=e.url,t=e.skipKeys;e=e.errorMsg;if(r){var a=r.toLowerCase();if(a)return(r=t.find((function(e){return a.includes(e.toLowerCase())})))&&console.debug(e,r),!!r}return!1},getGoogleClickIdParameters=function(e,r){var t=r[GOOGLE_CLICK_ID],a={};return t?(console.debug("This user comes from Google AdWords"),a[e]=t,(e=r[ASSOCIATED_AD_KEYWORD])&&(console.debug("There is a keyword associated with the ad"),a[AF_KEYWORDS]=e)):console.debug("This user comes from SRN or custom network"),a},stringifyParameters=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(r,t){return e[t]&&(r+="&".concat(t,"=").concat(e[t])),r}),"")},getParameterValue=function(e){var r,t,a,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{keys:[],overrideValues:{},defaultValue:""};return null!=n&&n.keys&&Array.isArray(n.keys)||null!=n&&n.defaultValue?(t=n.keys,a=void 0===(a=n.overrideValues)?{}:a,r=void 0===(r=n.defaultValue)?"":r,(t=(void 0===t?[]:t).find((function(r){return!!e[r]})))&&(a[a=e[t]]||a)||r):(console.error("Parameter config structure is wrong",n),null)},isIOS=function(e){return/iphone|ipad|ipod/i.test(e&&e.toLowerCase())},isUACHSupported=function(){return"object"===("undefined"==typeof navigator?"undefined":_typeof(navigator))&&"userAgentData"in navigator&&"getHighEntropyValues"in navigator.userAgentData&&!isIOS(navigator&&navigator.userAgent)},getQueryParamsAndSaveToLocalStorage=function(e){e||console.debug("website doesnt exist + ".concat(e));try{var r=new URL(e),t=new URLSearchParams(r.search),a=Array.from(t).reduce((function(e,r){var t=(r=_slicedToArray(r,2))[0];r=r[1];return _objectSpread2(_objectSpread2({},e),{},_defineProperty({},t,encodeURIComponent(r)))}),{}),n=JSON.parse(localStorage.getItem("ss_incoming_params")||"[]"),o=(new Date).getTime()+72e5,i=_objectSpread2(_objectSpread2({},a),{},{af_ss_exp_at:o});n.unshift(i),localStorage.setItem("ss_incoming_params",JSON.stringify(n))}catch(e){console.debug("url isnt valid + ".concat(e))}},isValidUrl=function(e){try{return Boolean(new URL(e))}catch(e){return!1}},getCurrentUrl=function(){return new URL(window.location.href)},getReferrerUrl=function(){var e=document.referrer;return e?new URL(e):null},isSameOrigin=function(e,r){return e.origin===r.origin},saveWebReferrer=function(){var e=getCurrentUrl(),r=getReferrerUrl();r&&isSameOrigin(e,r)?console.warn("You navigate from the same website"):localStorage.setItem(LOCAL_STORAGE_VALUES.SS_WEB_REFERRER,JSON.stringify(document.referrer))},removeExpiredLocalStorageItems=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now(),r=JSON.parse(localStorage.getItem("ss_incoming_params")||"[]");localStorage.setItem("ss_incoming_params",JSON.stringify(r.filter((function(r){return r=r.af_ss_exp_at,e<r}))))};function aggregateValuesFromParameters(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=[];return Object.values(e).forEach((function(e){e&&e.keys&&Array.isArray(e.keys)&&e.keys.forEach((function(e){return r.push(e)})),Array.isArray(e)&&e.forEach((function(e){Array.isArray(null==e?void 0:e.keys)&&r.push.apply(r,_toConsumableArray(e.keys))}))})),e.hasOwnProperty("googleClickIdKey")&&"string"==typeof e.googleClickIdKey&&r.push(GOOGLE_CLICK_ID),r}function getCurrentURLParams(e){var r={};return Object.keys(localStorage).includes("ss_incoming_params")?r=JSON.parse(localStorage.ss_incoming_params).find((function(r){return e.some((function(e){return e in r}))}))||{}:console.log("Key 'ss_incoming_params' not found in localStorage."),r}var isOneLinkURLValid=function(e){var r=null==(r=e||"")?void 0:r.toString().match(AF_URL_SCHEME);return!(!r||(null==r?void 0:r.length)<VALID_AF_URL_PARTS_LENGTH)||(console.error("oneLinkURL is missing or not in the correct format, can't generate URL",e),!1)},isMSValid=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!(null==e||!e.defaultValue)||(console.error("mediaSource is missing (default value was not supplied), can't generate URL",e),!1)},isSkipListsValid=function(e){var r=e.referrerSkipList;e=void 0===(e=e.urlSkipList)?[]:e;return!isSkippedURL({url:document.referrer,skipKeys:void 0===r?[]:r,errorMsg:"Generate url is skipped. HTTP referrer contains key:"})&&!isSkippedURL({url:document.URL,skipKeys:e,errorMsg:"Generate url is skipped. URL contains string:"})},extractCustomParams=function(e){var r=void 0===(r=e.afCustom)?[]:r,t=e.currentURLParams,a=void 0===t?{}:t,n=e.googleClickIdKey,o={};return Array.isArray(r)&&r.forEach((function(e){var r;null!=e&&e.paramKey&&(r=AF_CUSTOM_EXCLUDE_PARAMS_KEYS.find((function(r){return r===(null==e?void 0:e.paramKey)})),(null==e?void 0:e.paramKey)===n||r?console.debug("Custom parameter ParamKey can't override Google-Click-Id or AF Parameters keys",e):o[e.paramKey]=getParameterValue(a,e))})),o},validateAndMappedParams=function(){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],t=(y=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).mediaSource,a=y.campaign,n=y.channel,o=y.ad,i=y.adSet,s=y.deepLinkValue,l=y.afSub1,c=y.afSub2,u=y.afSub3,f=y.afSub4,d=y.afSub5,m=y.afCustom,p=y.googleClickIdKey,g={};if(t){if(!(y=getParameterValue(e,t)))return console.error("mediaSource was not found in the URL and default value was not supplied, can't generate URL",t),null;g[r?"af_media_source":"pid"]=y}if(a){if(!(t=getParameterValue(e,a))&&r)return console.error("campaign was not found in the URL and default value was not supplied, can't generate URL",a),null;r?(g.af_campaign=t,g.af_campaign_id=t):g.c=t}n&&(g.af_channel=getParameterValue(e,n)),o&&(g.af_ad=getParameterValue(e,o)),i&&(g.af_adset=getParameterValue(e,i)),s&&(g.deep_link_value=getParameterValue(e,s)),[l,c,u,f,d].forEach((function(r,t){r&&(g["af_sub".concat(t+1)]=getParameterValue(e,r))})),p&&(GCLID_EXCLUDE_PARAMS_KEYS.find((function(e){return e===p}))?console.debug("Google Click Id ParamKey can't override AF Parameters keys",p):(_=getGoogleClickIdParameters(p,e),Object.keys(_).forEach((function(e){g[e]=_[e]}))));var _,y=extractCustomParams({afCustom:m,currentURLParams:e,googleClickIdKey:p});return _objectSpread2(_objectSpread2({},g),y)},isPlatformValid=function(e){return e?!!["smartcast","tizen","roku","webos","vidaa","playstation","android","ios","steam","quest","battlenet","epic","switch","xbox","nativepc"].includes(e.toLowerCase())||(console.error("platform need to be part of the known platforms supoorted"),!1):(console.error("platform is missing , can't generate URL",e),!1)};function getUserAgentData(){return new Promise((function(e){isUACHSupported()?navigator.userAgentData.getHighEntropyValues(["model","platformVersion"]).then((function(r){e({model:r.model,platformVersion:r.platformVersion})})).catch((function(){e()})):e()}))}var createImpressionsLink=function(e){return e?new Promise((function(r){getUserAgentData().then((function(t){var a=new URL(e);a.hostname="impressions.onelink.me",t&&(a.searchParams.append("af_ch_model",encodeURIComponent(t.model)),a.searchParams.append("af_ch_os_version",encodeURIComponent(t.platformVersion))),r(a.href)})).catch((function(){r()}))})):(console.debug("ClickURL is not valid"),null)};function getHexColorAfterValidation(e){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(e)?e:"#000"}function getParameterValueFromURL(e,r){return new URLSearchParams(e).get(r)}function updateFinalUrlWithForwardParameters(e,r,t){return r.reduce((function(e,r){var a=getParameterValueFromURL(t,r);return a?(console.debug("The URL contains forwarding parameter ".concat(r,".")),"".concat(e,"&").concat(r,"=").concat(encodeURIComponent(a))):e}),e)}var processTrackingParameters=function(e){e=updateFinalUrlWithForwardParameters(e,[GOOGLE_CLICK_ID,FACEBOOK_CLICK_ID,GBRAID,WBRAID],window.location.search);var r=getParameterValueFromURL(window.location.search,GOOGLE_CLICK_ID),t=getParameterValueFromURL(window.location.search,GBRAID),a=getParameterValueFromURL(window.location.search,WBRAID);return(r||t||a)&&(r=getParameterValueFromURL(window.location.search,ASSOCIATED_AD_KEYWORD),t=getParameterValueFromURL(e,AF_KEYWORDS),r)&&!t?"".concat(e,"&").concat(AF_KEYWORDS,"=").concat(r):e},version="2.9.3",formatVersion=version.replace(/\./g,"_");removeExpiredLocalStorageItems(),getQueryParamsAndSaveToLocalStorage(window.location.href),saveWebReferrer(),window.AF_SMART_SCRIPT={generateOneLinkURL:function(){var e,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{afParameters:{}},t=r.oneLinkURL,a=(void 0===(a=r.afParameters)?{}:a).mediaSource,n=void 0===(n=r.referrerSkipList)?[]:n,o=void 0===(o=r.urlSkipList)?[]:o,i=r.webReferrer;return isOneLinkURLValid(t)&&isSkipListsValid({referrerSkipList:n,urlSkipList:o})&&isMSValid(a)&&(n=getCurrentURLParams(aggregateValuesFromParameters(r.afParameters)),o=validateAndMappedParams(r.afParameters,n))?(a=_objectSpread2({af_js_web:!0,af_ss_ver:window.AF_SMART_SCRIPT.version},o),e=t+stringifyParameters(a).replace("&","?"),r=JSON.parse(localStorage.getItem(LOCAL_STORAGE_VALUES.SS_WEB_REFERRER)),i&&r&&isValidUrl(r)&&(n="&".concat(i,"=").concat(r),e="".concat(e).concat(n)),e=processTrackingParameters(e),createImpressionsLink(e).then((function(e){e&&(window.AF_SMART_SCRIPT.fireImpressionsLink=function(){var r=new Image(1,1);r.style.display="none",r.style.position="absolute",r.style.left="-1px",r.style.top="-1px",r.src=e})})),{clickURL:e}):null},generateDirectClickURL:function(){var e,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{afParameters:{},referrerSkipList:[],urlSkipList:[]},t=void 0===(t=r.afParameters)?{}:t,a=void 0===(a=r.referrerSkipList)?[]:a,n=void 0===(n=r.urlSkipList)?[]:n,o=r.platform,i=r.app_id,s=r.redirectURL,l=t.mediaSource;t=t.campaign;return l?t?i?s?(o=null==o?void 0:o.toLowerCase(),isPlatformValid(o)?"string"!=typeof i?(console.error("app_id must be a string"),null):0!==(null==t||null==(e=t.keys)?void 0:e.length)||null!=t&&t.defaultValue?isSkipListsValid({referrerSkipList:a,urlSkipList:n})&&isMSValid(l)&&(e=getCurrentURLParams(aggregateValuesFromParameters(r.afParameters)),a=validateAndMappedParams(r.afParameters,e,!0))?(n=_objectSpread2({af_js_web:!0,af_ss_ver:window.AF_SMART_SCRIPT.version},a),r=stringifyParameters(n).replace("&","?"),e="https://engagements.appsflyer.com/v1.0/c2s/click/app/".concat(o),["ios","android"].includes(o)&&(e="https://app.appsflyer.com"),a="".concat(e,"/").concat(i).concat(r,"&af_r=").concat(encodeURIComponent(s)),["ios","android"].includes(o)&&(a=a.replace("af_media_source","pid").replace("af_campaign","c").replace("af_campaign_id","af_c_id")),a=processTrackingParameters(a),console.debug("generate Direct Click URL",a),delete window.AF_SMART_SCRIPT.fireImpressionsLink,{clickURL:a}):null:(console.error("campaign is missing (default value was not supplied), can't generate URL",l),null):null):(console.error("redirectURL is missing , can't generate URL",s),null):(console.error("app_id is missing , can't generate URL",i),null):(console.error("campaign  is missing , can't generate URL",t),null):(console.error("mediaSource is missing , can't generate URL",l),null)},version:formatVersion};
//# sourceMappingURL=smart-script.js.map